{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Alan/hackathon/fin-assist/src/components/VoiceInterface/VoiceInterface.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\n\r\ninterface VoiceInterfaceProps {\r\n  className?: string;\r\n}\r\n\r\nexport default function VoiceInterface({ className = \"\" }: VoiceInterfaceProps) {\r\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\r\n  const chunksRef = useRef<BlobPart[]>([]);\r\n  const [recording, setRecording] = useState(false);\r\n  const [status, setStatus] = useState<string>(\"Ready to listen\");\r\n  const [transcript, setTranscript] = useState<string>(\"\");\r\n  const [reply, setReply] = useState<string>(\"\");\r\n  const [isListening, setIsListening] = useState(false);\r\n  const audioRef = useRef<HTMLAudioElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (mediaRecorderRef.current && mediaRecorderRef.current.state !== \"inactive\") {\r\n        mediaRecorderRef.current.stop();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  async function startRecording() {\r\n    setTranscript(\"\");\r\n    setReply(\"\");\r\n    setStatus(\"Requesting microphone access...\");\r\n    setIsListening(true);\r\n\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      const recorder = new MediaRecorder(stream, { mimeType: \"audio/webm\" });\r\n      chunksRef.current = [];\r\n\r\n      recorder.ondataavailable = (e) => {\r\n        if (e.data.size > 0) chunksRef.current.push(e.data);\r\n      };\r\n\r\n      recorder.onstop = async () => {\r\n        const blob = new Blob(chunksRef.current, { type: \"audio/webm\" });\r\n        const form = new FormData();\r\n        form.append(\"audio\", blob, \"audio.webm\");\r\n        setStatus(\"Processing your request...\");\r\n\r\n        try {\r\n          const res = await fetch(\"/api/voice/turn\", { method: \"POST\", body: form });\r\n          if (!res.ok) {\r\n            setStatus(\"Error processing request\");\r\n            return;\r\n          }\r\n\r\n          const audioBuf = await res.arrayBuffer();\r\n          const transcriptHdr = res.headers.get(\"x-transcript\");\r\n          const replyHdr = res.headers.get(\"x-text\");\r\n          setTranscript(transcriptHdr ? decodeURIComponent(transcriptHdr) : \"\");\r\n          setReply(replyHdr ? decodeURIComponent(replyHdr) : \"\");\r\n\r\n          const url = URL.createObjectURL(new Blob([audioBuf], { type: res.headers.get(\"content-type\") || \"audio/mpeg\" }));\r\n          if (audioRef.current) {\r\n            audioRef.current.src = url;\r\n            await audioRef.current.play().catch(() => {});\r\n          }\r\n          setStatus(\"Response ready\");\r\n        } catch (error) {\r\n          console.error(\"Error:\", error);\r\n          setStatus(\"Error processing request\");\r\n        }\r\n      };\r\n\r\n      recorder.start();\r\n      mediaRecorderRef.current = recorder;\r\n      setRecording(true);\r\n      setStatus(\"Listening...\");\r\n    } catch (error) {\r\n      console.error(\"Error accessing microphone:\", error);\r\n      setStatus(\"Microphone access denied\");\r\n      setIsListening(false);\r\n    }\r\n  }\r\n\r\n  function stopRecording() {\r\n    if (mediaRecorderRef.current && mediaRecorderRef.current.state !== \"inactive\") {\r\n      mediaRecorderRef.current.stop();\r\n    }\r\n    setRecording(false);\r\n    setIsListening(false);\r\n    setStatus(\"Processing...\");\r\n  }\r\n\r\n  return (\r\n    <div className={`bg-white rounded-lg shadow-lg p-8 ${className}`}>\r\n      <div className=\"text-center mb-8\">\r\n        <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">\r\n          Voice Assistant\r\n        </h2>\r\n        <p className=\"text-gray-600\">\r\n          Speak naturally about your financial questions or concerns\r\n        </p>\r\n      </div>\r\n\r\n      {/* Voice Input Section */}\r\n      <div className=\"mb-8\">\r\n        <div className=\"flex justify-center mb-6\">\r\n          <button\r\n            className={`\r\n              w-32 h-32 rounded-full border-4 transition-all duration-300 flex items-center justify-center\r\n              ${isListening\r\n                ? 'border-red-500 bg-red-50 animate-pulse'\r\n                : 'border-blue-500 bg-blue-50 hover:bg-blue-100'\r\n              }\r\n            `}\r\n            onMouseDown={startRecording}\r\n            onMouseUp={stopRecording}\r\n            onTouchStart={(e) => { e.preventDefault(); startRecording(); }}\r\n            onTouchEnd={(e) => { e.preventDefault(); stopRecording(); }}\r\n          >\r\n            <div className=\"text-center\">\r\n              <i className={`fas fa-microphone text-3xl mb-2 ${\r\n                isListening ? 'text-red-500' : 'text-blue-500'\r\n              }`}></i>\r\n              <div className=\"text-sm font-medium text-gray-700\">\r\n                {isListening ? 'Listening...' : 'Hold to Speak'}\r\n              </div>\r\n            </div>\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className={`text-sm font-medium ${\r\n            isListening ? 'text-red-600' : 'text-gray-500'\r\n          }`}>\r\n            {status}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Transcript and Response */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        <div className=\"space-y-2\">\r\n          <h3 className=\"text-lg font-semibold text-gray-800 flex items-center\">\r\n            <i className=\"fas fa-user mr-2 text-blue-500\"></i>\r\n            You said\r\n          </h3>\r\n          <div className=\"min-h-[120px] p-4 border border-gray-200 rounded-lg bg-gray-50\">\r\n            {transcript || (\r\n              <div className=\"text-gray-400 italic\">\r\n                Your spoken words will appear here...\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-2\">\r\n          <h3 className=\"text-lg font-semibold text-gray-800 flex items-center\">\r\n            <i className=\"fas fa-robot mr-2 text-green-500\"></i>\r\n            Assistant response\r\n          </h3>\r\n          <div className=\"min-h-[120px] p-4 border border-gray-200 rounded-lg bg-green-50\">\r\n            {reply || (\r\n              <div className=\"text-gray-400 italic\">\r\n                AI responses will appear here...\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Audio Player */}\r\n      {reply && (\r\n        <div className=\"mt-6 pt-6 border-t border-gray-200\">\r\n          <audio ref={audioRef} controls className=\"w-full\" />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}