{"version":3,"sources":["../../src/metrics/utils.ts"],"sourcesContent":["// SPDX-FileCopyrightText: 2024 LiveKit, Inc.\n//\n// SPDX-License-Identifier: Apache-2.0\nimport { log } from '../log.js';\nimport type { AgentMetrics } from './base.js';\n\nfunction roundTwoDecimals(value: number) {\n  return Math.round(value * 100) / 100;\n}\n\nexport const logMetrics = (metrics: AgentMetrics) => {\n  const logger = log();\n  if (metrics.type === 'llm_metrics') {\n    logger\n      .child({\n        ttftMs: roundTwoDecimals(metrics.ttftMs),\n        inputTokens: metrics.promptTokens,\n        promptCachedTokens: metrics.promptCachedTokens,\n        outputTokens: metrics.completionTokens,\n        tokensPerSecond: roundTwoDecimals(metrics.tokensPerSecond),\n      })\n      .info('LLM metrics');\n  } else if (metrics.type === 'realtime_model_metrics') {\n    logger\n      .child({\n        ttftMs: roundTwoDecimals(metrics.ttftMs),\n        input_tokens: metrics.inputTokens,\n        cached_input_tokens: metrics.inputTokenDetails.cachedTokens,\n        output_tokens: metrics.outputTokens,\n        total_tokens: metrics.totalTokens,\n        tokens_per_second: roundTwoDecimals(metrics.tokensPerSecond),\n      })\n      .info('RealtimeModel metrics');\n  } else if (metrics.type === 'tts_metrics') {\n    logger\n      .child({\n        ttfbMs: roundTwoDecimals(metrics.ttfbMs),\n        audioDurationMs: Math.round(metrics.audioDurationMs),\n      })\n      .info('TTS metrics');\n  } else if (metrics.type === 'eou_metrics') {\n    logger\n      .child({\n        endOfUtteranceDelayMs: roundTwoDecimals(metrics.endOfUtteranceDelayMs),\n        transcriptionDelayMs: roundTwoDecimals(metrics.transcriptionDelayMs),\n        onUserTurnCompletedDelayMs: roundTwoDecimals(metrics.onUserTurnCompletedDelayMs),\n      })\n      .info('EOU metrics');\n  } else if (metrics.type === 'vad_metrics') {\n    logger\n      .child({\n        idleTimeMs: Math.round(metrics.idleTimeMs),\n        inferenceDurationTotalMs: Math.round(metrics.inferenceDurationTotalMs),\n        inferenceCount: metrics.inferenceCount,\n      })\n      .info('VAD metrics');\n  } else if (metrics.type === 'stt_metrics') {\n    logger\n      .child({\n        audioDurationMs: Math.round(metrics.audioDurationMs),\n      })\n      .info('STT metrics');\n  }\n};\n"],"mappings":"AAGA,SAAS,WAAW;AAGpB,SAAS,iBAAiB,OAAe;AACvC,SAAO,KAAK,MAAM,QAAQ,GAAG,IAAI;AACnC;AAEO,MAAM,aAAa,CAAC,YAA0B;AACnD,QAAM,SAAS,IAAI;AACnB,MAAI,QAAQ,SAAS,eAAe;AAClC,WACG,MAAM;AAAA,MACL,QAAQ,iBAAiB,QAAQ,MAAM;AAAA,MACvC,aAAa,QAAQ;AAAA,MACrB,oBAAoB,QAAQ;AAAA,MAC5B,cAAc,QAAQ;AAAA,MACtB,iBAAiB,iBAAiB,QAAQ,eAAe;AAAA,IAC3D,CAAC,EACA,KAAK,aAAa;AAAA,EACvB,WAAW,QAAQ,SAAS,0BAA0B;AACpD,WACG,MAAM;AAAA,MACL,QAAQ,iBAAiB,QAAQ,MAAM;AAAA,MACvC,cAAc,QAAQ;AAAA,MACtB,qBAAqB,QAAQ,kBAAkB;AAAA,MAC/C,eAAe,QAAQ;AAAA,MACvB,cAAc,QAAQ;AAAA,MACtB,mBAAmB,iBAAiB,QAAQ,eAAe;AAAA,IAC7D,CAAC,EACA,KAAK,uBAAuB;AAAA,EACjC,WAAW,QAAQ,SAAS,eAAe;AACzC,WACG,MAAM;AAAA,MACL,QAAQ,iBAAiB,QAAQ,MAAM;AAAA,MACvC,iBAAiB,KAAK,MAAM,QAAQ,eAAe;AAAA,IACrD,CAAC,EACA,KAAK,aAAa;AAAA,EACvB,WAAW,QAAQ,SAAS,eAAe;AACzC,WACG,MAAM;AAAA,MACL,uBAAuB,iBAAiB,QAAQ,qBAAqB;AAAA,MACrE,sBAAsB,iBAAiB,QAAQ,oBAAoB;AAAA,MACnE,4BAA4B,iBAAiB,QAAQ,0BAA0B;AAAA,IACjF,CAAC,EACA,KAAK,aAAa;AAAA,EACvB,WAAW,QAAQ,SAAS,eAAe;AACzC,WACG,MAAM;AAAA,MACL,YAAY,KAAK,MAAM,QAAQ,UAAU;AAAA,MACzC,0BAA0B,KAAK,MAAM,QAAQ,wBAAwB;AAAA,MACrE,gBAAgB,QAAQ;AAAA,IAC1B,CAAC,EACA,KAAK,aAAa;AAAA,EACvB,WAAW,QAAQ,SAAS,eAAe;AACzC,WACG,MAAM;AAAA,MACL,iBAAiB,KAAK,MAAM,QAAQ,eAAe;AAAA,IACrD,CAAC,EACA,KAAK,aAAa;AAAA,EACvB;AACF;","names":[]}